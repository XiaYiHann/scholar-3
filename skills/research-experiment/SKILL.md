---
name: research-experiment
description: 进入实验验证模式 - 设计实验、编写代码、运行实验和分析结果。当用户想要实现研究想法、运行实验、分析数据或验证假设时使用。
version: 1.0.0
metadata:
  phase: experiment
  inputs:
    - research/idea-proposal.md
  outputs:
    - research/experiment-report.md
---

进入实验验证模式。设计实验。实现代码。运行并分析结果。

**这是研究的第二阶段：实验与验证。** 目标是将研究想法转化为可执行的实验，收集数据并分析结果。应该遵循代码规范、确保可复现性、并进行系统的实验分析。

---

## 核心活动

根据实验需求，可能会进行以下活动：

**实验设计**
- 根据 proposal 设计实验方案
- 定义对照组和实验组
- 确定评估指标
- 规划消融实验

**代码实现**
- 调用 architect agent 设计项目架构
- 遵循 coding-style.md 编写代码
- 实现实验逻辑
- 编写测试确保正确性

**实验执行**
- 配置实验环境
- 运行实验并记录
- 确保随机种子设置
- 保存 checkpoint 和日志

**结果分析**
- 调用 data-analyst agent 分析结果
- 生成可视化图表
- 进行统计显著性检验
- 与 baseline 对比

---

## 姿态

- **系统化** - 实验设计应该系统完整，而非零散
- **可复现** - 确保实验可以被复现
- **数据驱动** - 让数据说话，不要过度解读
- **严谨** - 遵循科学实验的最佳实践

---

## 实验流程

**1. 设计阶段**
```
┌─────────────────────────────────────────────────┐
│              实 验 设 计                        │
├─────────────────────────────────────────────────┤
│                                                 │
│  输入: idea-proposal.md                         │
│       │                                        │
│       ▼                                        │
│  ┌──────────────┐    ┌──────────────┐         │
│  │  实验设计    │───▶│  架构设计    │         │
│  │  (变量/指标) │    │  (architect) │         │
│  └──────────────┘    └──────────────┘         │
│                                                 │
└─────────────────────────────────────────────────┘
```

**2. 实现阶段**
- 使用 openspec-new-change 或 openspec-ff-change 开始实现
- 遵循代码规范（小文件原则、类型提示、docstring）
- 编写测试确保代码质量

**3. 运行阶段**
- 设置随机种子确保可复现
- 记录环境信息（GPU、依赖版本）
- 保存 checkpoint

**4. 分析阶段**
- 使用 data-analyst agent 分析结果
- 生成图表和表格
- 进行统计检验

---

## 代码规范检查清单

实现代码时，确保：
- [ ] 每个文件不超过 400 行
- [ ] 使用 dataclass 作为配置（不可变）
- [ ] 所有函数有类型提示
- [ ] 有明确的错误处理
- [ ] 使用 logger 而非 print
- [ ] 设置随机种子

---

## 可复现性要求

- 设置随机种子（见 experiment-reproducibility.md）
- 记录环境信息（pip freeze）
- 保存完整配置
- 保存 checkpoint
- 记录运行命令

---

## 输出模板

实验完成后，生成 `research/experiment-report.md`：

```markdown
# Experiment Report: [实验名称]

## Setup
- 硬件: GPU/CPU
- 环境: pip freeze 输出
- 配置: config.yaml

## Results
- 定量结果表格
- 可视化图表

## Analysis
- 统计显著性检验
- 消融实验结果
- 与 baseline 对比

## Conclusion
- 假设是否成立
- 局限性分析
- 下一步行动

## Reproducibility
- 随机种子
- checkpoint 路径
- 运行命令
```

---

## 护栏

- **不要跳过设计** - 在开始编码前，先设计好实验
- **不要忽略可复现性** - 确保实验可以被复现
- **不要过度解读结果** - 让数据说话
- **要记录一切** - 环境、配置、命令、结果

---

## 相关资源

- 详见 `references/experiment-workflow.md` 了解详细工作流
- 使用 `templates/experiment-report.md` 作为输出模板
- 上一阶段：使用 `/discover` 回到探索模式
- 下一阶段：使用 `/paper` 进入论文撰写模式
